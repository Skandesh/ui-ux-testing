<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI/UX Testing - Pixel Perfect Comparison</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>UI/UX Design Specification Testing</h1>
        <p class="subtitle">Compare Figma JSON specifications with code implementation</p>
        
        <div class="tabs hidden" id="resultTabs">
            <button class="tab-button active" onclick="showResultTab('overview')">Comparison Overview</button>
            <button class="tab-button" onclick="showResultTab('detailed')">Detailed Analysis</button>
            <button class="tab-button" onclick="showResultTab('fields')">Field Analysis</button>
            <button class="tab-button" onclick="showResultTab('element-comparison')">Element Comparison</button>
            <button class="tab-button" onclick="showResultTab('ai-analysis')">AI Analysis</button>
        </div>
        
        <div class="upload-section">
                <form id="compareForm">
                    <div class="upload-grid">
                        <div class="upload-box">
                            <h3>Figma Design</h3>
                            <div class="figma-input-section">
                                <div class="input-group">
                                    <label for="figmaLink">Figma Link</label>
                                    <input type="url" id="figmaLink" placeholder="https://www.figma.com/file/..." />
                                    <small>Paste your Figma design link (supports file and node URLs)</small>
                                </div>
                                <div class="input-group">
                                    <label for="figmaToken">Access Token</label>
                                    <input type="password" id="figmaToken" placeholder="Your Figma personal access token" />
                                    <small>Get token from Figma ‚Üí Settings ‚Üí Personal access tokens</small>
                                </div>
                                <div class="input-group">
                                    <label for="figmaCookie">Cookie (Optional)</label>
                                    <input type="text" id="figmaCookie" placeholder="Paste cookie string if required for authentication" />
                                    <small>Copy from browser DevTools ‚Üí Network ‚Üí Headers ‚Üí Cookie</small>
                                </div>
                                <div class="input-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="useProxy" />
                                        <span>Use corporate proxy (proxy.jpmchase.net:8443)</span>
                                    </label>
                                </div>
                                <button type="button" id="fetchFigmaBtn" class="fetch-btn">Fetch Design</button>
                                <div id="figmaStatus" class="status-message"></div>
                            </div>
                            <div class="ai-input-section">
                                <h4>AI Enhancement (Optional)</h4>
                                <div class="input-group">
                                    <label for="openaiApiKey">OpenAI API Key</label>
                                    <input type="password" id="openaiApiKey" placeholder="sk-..." />
                                    <small>Optional: Enable AI-powered analysis with GPT-4 Vision</small>
                                </div>
                            </div>
                            <div class="json-preview" id="jsonPreview"></div>
                        </div>
                        
                        <div class="upload-box">
                            <h3>Code Output Screenshot</h3>
                            <input type="file" id="codeScreenshot" name="codeScreenshot" accept="image/*" required>
                            <div class="preview" id="screenshotPreview"></div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" class="compare-btn">Compare Images</button>
                        <button type="button" id="rawAnalyzeBtn" class="compare-btn raw-btn">Raw Analysis (No AI)</button>
                        <button type="button" id="elementCompareBtn" class="compare-btn element-btn">Element Comparison (OCR)</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- OpenAI Field Detection Tool -->
        <div class="field-detection-tool">
            <h2>üîç OpenAI Field Detection Tool</h2>
            <p class="tool-description">Test what OpenAI detects in your UI screenshots</p>
            
            <div class="detection-upload-section">
                <div class="detection-inputs">
                    <div class="input-group">
                        <label for="detectionImage">Upload Screenshot</label>
                        <input type="file" id="detectionImage" accept="image/*" />
                        <button type="button" id="useMainScreenshotBtn" class="use-last-btn">Use Code Output Screenshot</button>
                        <div id="detectionImagePreview" class="image-preview"></div>
                    </div>
                    <div class="input-group">
                        <label for="detectionApiKey">OpenAI API Key</label>
                        <input type="password" id="detectionApiKey" placeholder="sk-..." />
                    </div>
                    <button id="detectFieldsBtn" class="detect-btn">Detect Fields</button>
                </div>
                
                <div id="detectionLoading" class="detection-loading hidden">
                    <div class="spinner"></div>
                    <p>Analyzing image with OpenAI...</p>
                </div>
                
                <div id="detectionResults" class="detection-results hidden">
                    <h3>Detection Results</h3>
                    
                    <div class="detection-summary">
                        <div class="summary-stats">
                            <div class="stat-item">
                                <span class="stat-label">Total Elements</span>
                                <span id="totalDetected" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Screen Type</span>
                                <span id="detectedScreenType" class="stat-value">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detected-elements">
                        <h4>Detected Elements</h4>
                        <div id="elementsList" class="elements-list"></div>
                    </div>
                    
                    <div class="raw-response">
                        <h4>Raw OpenAI Response</h4>
                        <details>
                            <summary>View Raw JSON</summary>
                            <pre id="rawDetectionResponse"></pre>
                        </details>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Analyzing pixel differences...</p>
        </div>
        
        <div id="results" class="results hidden">
            <!-- Dimension Validation Warning -->
            <div id="dimensionWarning" class="dimension-warning hidden">
                <div class="warning-icon">‚ö†Ô∏è</div>
                <div class="warning-content">
                    <h4>Dimension Mismatch Detected</h4>
                    <p id="dimensionWarningMessage"></p>
                </div>
            </div>
            
            <div id="overview-tab" class="result-tab-content active">
            <div class="similarity-score">
                <h2>Similarity Score</h2>
                <div class="score-circle" id="scoreCircle">
                    <span class="score-value" id="similarity">-</span>
                    <span class="score-label">match</span>
                </div>
                <p class="score-description" id="scoreDescription"></p>
            </div>
            
            <div class="comparison-view">
                <h3>Design Specification vs Implementation</h3>
                <div class="spec-comparison">
                    <div class="spec-side">
                        <h4>Figma Specifications</h4>
                        <div id="specDisplay"></div>
                    </div>
                    <div class="impl-side">
                        <h4>Detected Properties</h4>
                        <div id="detectedDisplay"></div>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat">
                    <span class="stat-label">UI Regions with Differences</span>
                    <span class="stat-value" id="diffRegions">-</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total Pixels Affected</span>
                    <span class="stat-value" id="diffPixels">-</span>
                </div>
            </div>
            
            <div class="spacing-visualization">
                <h3>Spacing & Layout Analysis</h3>
                <div class="visualization-container">
                    <img id="spacingOverlay" alt="Spacing and Layout Overlay" style="display: none;">
                    <p id="spacingOverlayPlaceholder">Spacing visualization will appear here when available</p>
                </div>
                <div class="spacing-legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #3b82f6;"></span>
                        <span>UI Elements</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #ff9800;"></span>
                        <span>Spacing Measurements</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #4caf50;"></span>
                        <span>Text Regions</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #ef4444;"></span>
                        <span>Major Issues</span>
                    </div>
                </div>
            </div>
            
            <details class="original-images">
                <summary>View Original Images</summary>
                <div class="images-grid">
                    <div>
                        <h4>Figma Design</h4>
                        <img id="figmaResult" alt="Figma Design">
                    </div>
                    <div>
                        <h4>Rendered Screen</h4>
                        <img id="renderedResult" alt="Rendered Screen">
                    </div>
                </div>
            </details>
            
                <button id="downloadReport" class="download-btn">Download Report</button>
            </div>
            
            <div id="detailed-tab" class="result-tab-content">
                <div class="detailed-analysis">
                    <h2>Detailed Difference Analysis</h2>
                    
                    <div class="color-differences">
                        <h3>Color Variations</h3>
                        <div class="delta-e-legend">
                            <p><strong>Delta E (ŒîE) Scale:</strong></p>
                            <ul>
                                <li><span class="delta-badge perfect">ŒîE < 1.0</span> Not perceptible by human eye</li>
                                <li><span class="delta-badge good">ŒîE 1.0-2.3</span> Barely perceptible</li>
                                <li><span class="delta-badge warning">ŒîE 2.3-10</span> Perceptible difference</li>
                                <li><span class="delta-badge error">ŒîE > 10</span> Different colors</li>
                            </ul>
                        </div>
                        <div id="colorComparison" class="color-grid">
                            <!-- Color differences will be populated here -->
                        </div>
                    </div>
                    
                    <div class="property-differences">
                        <h3>Property Mismatches</h3>
                        <div id="propertyMismatches" class="mismatch-grid">
                            <!-- Property mismatches will be populated here -->
                        </div>
                    </div>
                    
                    <div class="difference-categories">
                        <h3>Difference Categories</h3>
                        <div class="category-grid">
                            <div class="category-item">
                                <span class="category-icon">üé®</span>
                                <span class="category-label">Color Differences</span>
                                <span class="category-count" id="colorDiffCount">-</span>
                            </div>
                            <div class="category-item">
                                <span class="category-icon">üìè</span>
                                <span class="category-label">Spacing Issues</span>
                                <span class="category-count" id="spacingDiffCount">-</span>
                            </div>
                            <div class="category-item">
                                <span class="category-icon">üî§</span>
                                <span class="category-label">Text Variations</span>
                                <span class="category-count" id="textDiffCount">-</span>
                            </div>
                            <div class="category-item">
                                <span class="category-icon">üìê</span>
                                <span class="category-label">Size Differences</span>
                                <span class="category-count" id="sizeDiffCount">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="fields-tab" class="result-tab-content">
                <div class="fields-analysis">
                    <h2>Field-Based Analysis</h2>
                    
                    <!-- Screen Type Detection -->
                    <div class="screen-type-section">
                        <h3>Screen Type Detection</h3>
                        <div class="screen-type-info">
                            <div class="screen-type-result">
                                <span class="label">Detected Type:</span>
                                <span id="screenType" class="value">-</span>
                                <span id="screenTypeConfidence" class="confidence">-</span>
                            </div>
                            <div id="screenTypeIndicators" class="indicators"></div>
                        </div>
                    </div>
                    
                    <!-- Field Summary -->
                    <div class="field-summary">
                        <h3>Field Analysis Summary</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="label">Expected Fields</span>
                                <span id="expectedFieldCount" class="value">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">Detected Fields</span>
                                <span id="detectedFieldCount" class="value">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">Match Rate</span>
                                <span id="fieldMatchRate" class="value">0%</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">Field Score</span>
                                <span id="fieldScore" class="value">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Field Mappings -->
                    <div class="field-mappings">
                        <h3>Field-by-Field Comparison</h3>
                        <div id="fieldMappingsList" class="field-mappings-list">
                            <!-- Field mappings will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Unmatched Fields -->
                    <div class="unmatched-fields">
                        <div class="unmatched-section">
                            <h4>Missing Fields (In Design but Not Detected)</h4>
                            <div id="unmatchedFigmaFields" class="unmatched-list"></div>
                        </div>
                        <div class="unmatched-section">
                            <h4>Extra Fields (Detected but Not in Design)</h4>
                            <div id="unmatchedDetectedFields" class="unmatched-list"></div>
                        </div>
                    </div>
                    
                    <!-- Field Detection Comparison -->
                    <div class="field-detection-comparison">
                        <h3>Field Detection Accuracy</h3>
                        <div class="accuracy-metrics">
                            <div class="metric-grid">
                                <div class="metric-item">
                                    <span class="metric-label">Overall Accuracy</span>
                                    <div class="metric-bar">
                                        <div id="fieldOverallAccuracyBar" class="metric-fill"></div>
                                    </div>
                                    <span id="fieldOverallAccuracyValue" class="metric-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Position Accuracy</span>
                                    <div class="metric-bar">
                                        <div id="fieldPositionAccuracyBar" class="metric-fill"></div>
                                    </div>
                                    <span id="fieldPositionAccuracyValue" class="metric-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Type Accuracy</span>
                                    <div class="metric-bar">
                                        <div id="fieldTypeAccuracyBar" class="metric-fill"></div>
                                    </div>
                                    <span id="fieldTypeAccuracyValue" class="metric-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Dimension Accuracy</span>
                                    <div class="metric-bar">
                                        <div id="fieldDimensionAccuracyBar" class="metric-fill"></div>
                                    </div>
                                    <span id="fieldDimensionAccuracyValue" class="metric-value">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Field Groups -->
                    <div class="field-groups">
                        <h3>Field Groups</h3>
                        <div id="fieldGroupsList" class="field-groups-list">
                            <!-- Field groups will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="element-comparison-tab" class="result-tab-content">
                <div class="element-comparison">
                    <h2>Element-Level Comparison</h2>
                    <div class="element-summary">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <h3>Total Elements</h3>
                                <p id="totalElementsCount">-</p>
                            </div>
                            <div class="summary-card">
                                <h3>Matched Elements</h3>
                                <p id="matchedElementsCount">-</p>
                            </div>
                            <div class="summary-card success">
                                <h3>Matching</h3>
                                <p id="matchingCount">-</p>
                            </div>
                            <div class="summary-card error">
                                <h3>Not Matching</h3>
                                <p id="notMatchingCount">-</p>
                            </div>
                        </div>
                        <div class="accuracy-display">
                            <h3>Overall Accuracy</h3>
                            <div class="accuracy-value" id="elementAccuracy">-</div>
                        </div>
                    </div>
                    
                    <div class="element-filters">
                        <button class="filter-btn active" onclick="filterElements('all')">All Elements</button>
                        <button class="filter-btn" onclick="filterElements('matching')">Matching Only</button>
                        <button class="filter-btn" onclick="filterElements('not-matching')">Issues Only</button>
                        <button class="filter-btn" onclick="filterElements('color-issues')">Color Issues</button>
                        <button class="filter-btn" onclick="filterElements('font-issues')">Font Issues</button>
                    </div>
                    
                    <div class="element-comparison-table">
                        <table id="elementComparisonTable">
                            <thead>
                                <tr>
                                    <th>Element Text</th>
                                    <th>Match Type</th>
                                    <th>Figma Text Color</th>
                                    <th>UI Text Color</th>
                                    <th>Text Color Match</th>
                                    <th>Figma BG Color</th>
                                    <th>UI BG Color</th>
                                    <th>BG Color Match</th>
                                    <th>Font Size</th>
                                    <th>Overall Status</th>
                                    <th>Issues</th>
                                </tr>
                            </thead>
                            <tbody id="elementComparisonBody">
                                <!-- Populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="unmatched-elements">
                        <div class="unmatched-section">
                            <h3>Unmatched Figma Elements</h3>
                            <div id="unmatchedFigmaList" class="unmatched-list"></div>
                        </div>
                        <div class="unmatched-section">
                            <h3>Unmatched Screenshot Elements</h3>
                            <div id="unmatchedScreenshotList" class="unmatched-list"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="ai-analysis-tab" class="result-tab-content">
                <div class="ai-analysis">
                    <h2>AI-Powered Analysis</h2>
                    <div class="ai-overview">
                        <div class="ai-confidence">
                            <h3>AI Confidence Score</h3>
                            <div class="confidence-circle" id="aiConfidenceCircle">
                                <span class="confidence-value" id="aiConfidence">-</span>
                                <span class="confidence-label">confidence</span>
                            </div>
                            <p class="confidence-description" id="aiConfidenceDescription">AI analysis not available</p>
                        </div>
                        
                        <div class="analysis-comparison">
                            <h3>Analysis Comparison</h3>
                            <div class="comparison-stats">
                                <div class="stat">
                                    <span class="stat-label">Computer Vision Elements</span>
                                    <span class="stat-value" id="cvElementCount">-</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">AI Detected Elements</span>
                                    <span class="stat-value" id="aiElementCount">-</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Layout Complexity (CV)</span>
                                    <span class="stat-value" id="cvLayoutComplexity">-</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Layout Type (AI)</span>
                                    <span class="stat-value" id="aiLayoutType">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ai-insights">
                        <h3>AI Insights & Recommendations</h3>
                        <div class="insights-grid">
                            <div class="insight-section">
                                <h4>üß† AI Insights</h4>
                                <div id="aiInsightsList" class="insights-list">
                                    <p>No AI insights available. Provide an OpenAI API key to enable AI analysis.</p>
                                </div>
                            </div>
                            <div class="insight-section">
                                <h4>üí° Recommendations</h4>
                                <div id="aiRecommendationsList" class="recommendations-list">
                                    <p>No AI recommendations available. Provide an OpenAI API key to enable AI analysis.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ai-detailed-analysis">
                        <h3>Detailed AI Analysis</h3>
                        
                        <div class="ai-analysis-sections">
                            <div class="ai-section">
                                <h4>üé® Color Analysis</h4>
                                <div id="aiColorAnalysis" class="ai-content">
                                    <p>AI color analysis will appear here when available.</p>
                                </div>
                            </div>
                            
                            <div class="ai-section">
                                <h4>üìê Spacing & Layout</h4>
                                <div id="aiSpacingAnalysis" class="ai-content">
                                    <p>AI spacing analysis will appear here when available.</p>
                                </div>
                            </div>
                            
                            <div class="ai-section">
                                <h4>üî§ Typography</h4>
                                <div id="aiTypographyAnalysis" class="ai-content">
                                    <p>AI typography analysis will appear here when available.</p>
                                </div>
                            </div>
                            
                            <div class="ai-section">
                                <h4>‚ôø Accessibility</h4>
                                <div id="aiAccessibilityAnalysis" class="ai-content">
                                    <p>AI accessibility analysis will appear here when available.</p>
                                </div>
                            </div>
                        </div>
                        
                        <details class="ai-raw-response">
                            <summary>View Raw AI Response</summary>
                            <div id="aiRawResponse" class="ai-raw-content">
                                <pre>No AI response available</pre>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>